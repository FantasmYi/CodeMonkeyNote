# 1-redis
##  内存映射数据结构
  概述：当一个对象包含的元素数量不多，或元素本身的体积并不大时，使用代价高昂的内部数据结构并不是最好的办法。为解决这一问题，redis会使用内存映射数据结构代替内部数据结构。   
        注：内存映射数据结构的编码和操作方式比内部数据结构要复杂的多，所以占用的CPU时间会比作用类似的内部数据结构要多。  
###  整数集合（intset）：  
   有序，无重复的保存多个整数值，会根据元素的值，自动选择该用什么长度的整数类型来保存元素  
 * 整数集合的应用：  
    *  intSet是集合键的底层实现之一，如果一个集合：   
       1.只保存整数元素  
       2.元素的数量不多  
     那么redis就会用intset来保存集合元素   
    *  intSet类型的定义:   
    ```C
      typedef struct intset {   
         uint32_t encoding;  // 保存元素所使用的类型的长度    
         uint32_t length;  // 元素个数     
         int8_t contents[];  // 保存元素的数组   
      } intset;   
    ```     
     其中encoding的值可以是int16、int32、int64   
     contents中的元素有以下两个特性     
        * 没有重复元素  
        * 元素在数组中从小到大排列  
 * 当一个位长度更长的整数值添加到 intset 时，需要对 intset 进行升级，新 intset 中每个元素的位长度都等于新添加值的位长度，但原有元素的值不变。  
 * 升级会引起整个intset进行内存重新分配，并移动集合中的所有元素，操作复杂度O（n），注意，只能升级，不能降级  
 * intset是有序的，程序使用二分法实现查找，复杂度O（lgn）  

### 压缩列表（ziplist）   
   上一篇笔记中提到，程序创建新hash键或创建新的列表键时，默认使用压缩列表实现，当到达某一临界条件时，由压缩列表转换为字典/双端链表。     
   ziplist是由一系列特殊编码的内存块构成的列表，可以保存字符数组和整数值，它还是hash、list、sortset的底层实现之一。
       
