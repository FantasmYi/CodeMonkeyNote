## 上下文切换
### 时间片
 即使是单核CPU也能够运行多线程程序，多个线程会争取CPU的执行权，也叫时间片（通常十几），cpu会通过时间片分配算法在线程之间来回切换，对于用户来
说就像这些线程在并行执行一样。
### 并行一定比串行快吗？ 
 不一定，CPU由一个线程切换到另一个线程，需要保留当下的执行状态（执行到了哪一行，有哪些变量和变量值），在下次继续执行该线程时恢复到原来的状态，这个保存-恢复是会消耗额外空间的。   
### 如何避免频繁的上线文切换
#### 降低锁力度 
 对数据进行分段id哈希取模，每个线程操作其中一段数据，这在concurrentHashMap中有所体现。
#### CAS无锁操作
 synchronized锁释放-获得就会引起上下文切换，可以采用CAS操作实现来保证操作的原子性，但频繁的CAS也会消耗CPU
#### 使用最少线程
 线程的创建和销毁都会消耗系统资源，因此尽量使用池化技术管理线程，同事也避免了CPU在大量线程之间切换的问题
 
### 资源限制的挑战
 软件资源：池化复用 1.数据库连接数 2.socket连接数
 硬件资源：带宽有限

## 并发机制的底层原理实现
### 本地内存和线程安全问题
#### 缓存行
CPU不会直接与内存交互，而是通过总线将数据读到自己的一个缓存行中
#### 本地内存
虚拟出来的概念，实际上并不存在，其囊括了缓存行，写缓冲区等概念
#### 线程安全问题
究其原因就是线程在自己的本地内存中操作共享变量的，仅对执行自己的处理器可见而对其他处理器是不可见的，而他们在自己的本地内存对共享变量更新
